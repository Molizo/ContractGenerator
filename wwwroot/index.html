<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ContractGenerator</title>
    <base href="/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
    <link href="ContractGenerator.styles.css" rel="stylesheet" />
    <link href="manifest.json" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
</head>

<body>
    <div id="app">
        <div style="position:absolute; top:30vh; width:100%; text-align:center">
            <h1>Conference Contract Generator</h1>
            <p>The application is loading...</p>
        </div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webassembly.js"></script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>
    <script src="modules/popper.min.js"></script>
    <script src="modules/bootstrap.min.js"></script>
    <script src="modules/jsPDF/jspdf.umd.min.js"></script>
    <script src="modules/html2canvas.min.js"></script>
    <script src="modules/jsoneditor.js"></script>

    <script>
        window.jsPDF = window.jspdf.jsPDF;
        window.html2canvas = html2canvas;
        function saveIFrameAsPDF(iFrameID, name) {
            var object = document.getElementById(iFrameID).contentDocument.body;
            var pdf = new jsPDF({
                orientation: 'p',
                unit: 'mm',
                format: 'a4',
                putOnlyUsedFonts: true,
                floatPrecision: 16 // or "smart", default is 16
            });
            pdf.html(object, {
                callback: function (pdf) {
                    pdf.save(name);
                },
                x: 0,
                y: 0,
                margin: 10,
                autoPaging: 'text',
                width: 190,
                windowWidth: 700
            });
        }
        function setIFrame(iframeID, url) {
            var f = document.getElementById(iframeID);
            f.src = url;
        }
    </script>

	<script>
		function forceUnregisterSW(){
			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.getRegistrations().then(function(registrations) {
				for(let registration of registrations) {
						registration.unregister()
				}}).catch(function(err) {
					console.log('Service Worker registration failed: ', err);
				});
			}
		}
	</script>

    <script>
        var companiesEditor, conferencesEditor, contractsEditor;
        function setUpTemplateEditors(companiesSchema, conferencesSchema, contractsSchema) {
            JSONEditor.defaults.options.theme = 'bootstrap4';
            JSONEditor.defaults.options.enable_array_copy = true;
            JSONEditor.defaults.options.disable_edit_json = true;
            JSONEditor.defaults.options.disable_properties = true;
            companiesEditor = new JSONEditor(document.getElementById('companiesEditor'), {
                schema: JSON.parse(companiesSchema)
            });
            conferencesEditor = new JSONEditor(document.getElementById('conferencesEditor'), {
                schema: JSON.parse(conferencesSchema)
            });
            contractsEditor = new JSONEditor(document.getElementById('contractsEditor'), {
                schema: JSON.parse(contractsSchema)
            });
        }

        function updateTemplateEditorsContent(editor, value) {
            if(editor == "companies")
                companiesEditor.setValue(JSON.parse(value));
            else if (editor == "conferences")
                conferencesEditor.setValue(JSON.parse(value));
            else if (editor == "contracts")
                contractsEditor.setValue(JSON.parse(value));
        }

        function getTemplateEditorContent(editor) {
            if (editor == "companies")
                return companiesEditor.getValue();
            else if (editor == "conferences")
                return conferencesEditor.getValue();
            else if (editor == "contracts")
                return contractsEditor.getValue();
        }
    </script>
</html>
